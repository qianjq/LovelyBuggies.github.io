---
layout:     post
title:      ä»¥å¤ªåŠç§æœ‰é“¾æ­å»º
subtitle:   ç”¨Go-Ethereumæ­å»ºç§æœ‰é“¾å¹¶éƒ¨ç½²æ™ºèƒ½åˆçº¦
date:       2018-11-04
author:     Nino Lau
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - å®žéªŒ
    - ä¿¡æ¯å®‰å…¨

---

# çƒ­èº«æŠ¥å‘Š

[TOC]



> æ­¤æ–‡æ˜¯åŒºå—é“¾é¡¹ç›®çš„æœŸæœ« ðŸ”¥ çƒ­èº«æŠ¥å‘Šï¼Œç”¨æ¥å¸®åŠ©æˆ‘ä»¬ç†Ÿæ‚‰ä»¥å¤ªåŠå¼€å‘çŽ¯å¢ƒã€‚å®žéªŒä¸»è¦åŒ…æ‹¬ï¼š
>
> - ä»¥å¤ªåŠçš„å®‰è£…ã€ç§æœ‰é“¾åˆ›ä¸–åŒºå—çš„æ­å»ºï¼›
> - block å„ä¸ªå­—æ®µå’Œæ—¥å¿—çš„è¾“å‡ºè§£é‡Šï¼›
> - åœ¨ç§æœ‰é“¾éƒ¨ç½²ç®€å•çš„æ™ºèƒ½åˆçº¦ï¼›
> - å¯¹äº¤æ˜“å­—æ®µè¿›è¡Œè§£é‡Šã€‚



## ä»¥å¤ªåŠçš„å®‰è£…

æˆ‘æ˜¯åœ¨ Mac ä¸Šæ­å»ºçš„ Ethereum çŽ¯å¢ƒï¼Œæ­å»ºçš„è¿‡ç¨‹å¾ˆç®€å•ï¼š

```shell
brew tap ethereum/ethereum
brew install ethereum
geth --help 
```

å¦‚æžœèƒ½æˆåŠŸæ˜¾ç¤ºè¾“å‡ºå¸®åŠ©ï¼Œåˆ™è¡¨ç¤ºå·²ç»æˆåŠŸå®‰è£…ã€‚



## ç§æœ‰é“¾çŽ¯å¢ƒæ­å»º

### é…ç½®æ–‡ä»¶

ä»¥å¤ªåŠæ”¯æŒè‡ªå®šä¹‰åˆ›ä¸–åŒºå—ï¼Œè¦è¿è¡Œç§æœ‰é“¾ï¼Œæˆ‘ä»¬å°±éœ€è¦å®šä¹‰è‡ªå·±çš„åˆ›ä¸–åŒºå—ï¼Œåˆ›ä¸–åŒºå—ä¿¡æ¯å†™åœ¨ä¸€ä¸ª json æ ¼å¼çš„é…ç½®æ–‡ä»¶ä¸­ã€‚é¦–å…ˆå°†ä¸‹é¢çš„å†…å®¹ä¿å­˜åˆ°ä¸€ä¸ª json æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚ genesis.jsonã€‚ï¼ˆ*ç›´æŽ¥ä»Žå®˜ç½‘å¤åˆ¶ï¼Œâ€œchainIdâ€ ä¸º 0ï¼Œ ä½†æ˜¯ä¼šåœ¨åˆçº¦éƒ¨ç½²å‡ºçŽ°é—®é¢˜ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæ”¹ä¸º 666*ï¼‰

```json
{
  "config": {
        "chainId": 666,
        "homesteadBlock": 0,
        "eip155Block": 0,
        "eip158Block": 0
    },
  "alloc"      : {},
  "coinbase"   : "0x0000000000000000000000000000000000000000",
  "difficulty" : "0x00000001",
  "extraData"  : "",
  "gasLimit"   : "0xffffff",
  "nonce"      : "0x0000000000000042",
  "mixhash"    : "0x0000000000000000000000000000000000000000000000000000000000000000",
  "parentHash" : "0x0000000000000000000000000000000000000000000000000000000000000000",
  "timestamp"  : "0x00"
}
```

### åˆå§‹åŒ–ç§æœ‰é“¾

å‡†å¤‡å¥½åˆ›ä¸–åŒºå—é…ç½®æ–‡ä»¶åŽï¼Œéœ€è¦åˆå§‹åŒ–åŒºå—é“¾ï¼Œå°†ä¸Šé¢çš„åˆ›ä¸–åŒºå—ä¿¡æ¯å†™å…¥åˆ°åŒºå—é“¾ä¸­ã€‚é¦–å…ˆè¦æ–°å»ºä¸€ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾åŒºå—é“¾æ•°æ®ï¼Œå‡è®¾æ–°å»ºçš„æ•°æ®ç›®å½•ä¸º`~/nino/shuju`ï¼Œgenesis.json ä¿å­˜åœ¨`~/nino`ä¸­ï¼Œæ­¤æ—¶ç›®å½•ç»“æž„åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```
nino
â”œâ”€â”€ shuju
â””â”€â”€ genesis.json
```

è¿›å…¥ `~/nino` ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š

 ```shell
 geth -datadir shuju init genesis.json
 ```

ä¸Šé¢çš„å‘½ä»¤çš„ä¸»ä½“æ˜¯ geth initï¼Œè¡¨ç¤ºåˆå§‹åŒ–åŒºå—é“¾ï¼Œå‘½ä»¤å¯ä»¥å¸¦æœ‰é€‰é¡¹å’Œå‚æ•°ï¼Œå…¶ä¸­`--datadir`é€‰é¡¹åŽé¢è·Ÿä¸€ä¸ªç›®å½•åï¼Œè¿™é‡Œä¸º `shuju`ï¼Œè¡¨ç¤ºæŒ‡å®šæ•°æ®å­˜æ”¾ç›®å½•ä¸º `shuju`ï¼Œ `genesis.json`æ˜¯`init`å‘½ä»¤çš„å‚æ•°ã€‚è¿è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œä¼šè¯»å– genesis.json æ–‡ä»¶ï¼Œæ ¹æ®å…¶ä¸­çš„å†…å®¹ï¼Œå°†åˆ›ä¸–åŒºå—å†™å…¥åˆ°åŒºå—é“¾ä¸­ã€‚å¦‚æžœçœ‹åˆ°ä»¥ä¸‹çš„è¾“å‡ºå†…å®¹ï¼Œè¯´æ˜Žåˆå§‹åŒ–æˆåŠŸäº†ã€‚

```javascript
WARN [11-04|10:34:14] No etherbase set and no accounts found as default 
INFO [11-04|10:34:14] Allocated cache and file handles         database=/Users/nino/shuju/geth/chaindata cache=16 handles=16
INFO [11-04|10:34:14] Writing custom genesis block 
INFO [11-04|10:34:14] Successfully wrote genesis state         database=chaindata                                           hash=5e1fc7â€¦d790e0
INFO [11-04|10:34:14] Allocated cache and file handles         database=/Users/nino/shuju/geth/lightchaindata cache=16 handles=16
INFO [11-04|10:34:14] Writing custom genesis block 
INFO [11-04|10:34:14] Successfully wrote genesis state         database=lightchaindata                                           hash=5e1fc7â€¦d790e0
```

åˆå§‹åŒ–æˆåŠŸåŽï¼Œä¼šåœ¨æ•°æ®ç›®å½•`~/nino/shuju` ä¸­ç”Ÿæˆ geth å’Œ keystore ä¸¤ä¸ªæ–‡ä»¶å¤¹ã€‚(*å…¶ä¸­geth/chaindataä¸­å­˜æ”¾çš„æ˜¯åŒºå—æ•°æ®ï¼Œkeystoreä¸­å­˜æ”¾çš„æ˜¯è´¦æˆ·æ•°æ®*)

```
nino
â”œâ”€â”€ shuju
â”‚   â”œâ”€â”€ geth
â”‚   â”‚   â””â”€â”€ chaindata
â”‚   â”‚       â”œâ”€â”€ 000002.ldb
â”‚   â”‚       â”œâ”€â”€ 000003.log
â”‚   â”‚       â”œâ”€â”€ CURRENT
â”‚   â”‚       â”œâ”€â”€ LOCK
â”‚   â”‚       â”œâ”€â”€ LOG
â”‚   â”‚       â””â”€â”€ MANIFEST-000004
â”‚   â””â”€â”€ keystore
â””â”€â”€ genesis.json
```

### å¯åŠ¨ç§æœ‰é“¾

åˆå§‹åŒ–å®ŒæˆåŽï¼Œå°±æœ‰äº†ä¸€æ¡è‡ªå·±çš„ç§æœ‰é“¾ï¼Œä¹‹åŽå°±å¯ä»¥å¯åŠ¨è‡ªå·±çš„ç§æœ‰é“¾èŠ‚ç‚¹å¹¶åšä¸€äº›æ“ä½œï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯å¯åŠ¨èŠ‚ç‚¹ï¼š

```shell
geth -datadir shuju -networkid 2018 -rpc -rpcaddr ä½ çš„IP -rpccorsdomain "*" console
```

ä¸Šé¢å‘½ä»¤çš„ä¸»ä½“æ˜¯`geth console`ï¼Œè¡¨ç¤ºå¯åŠ¨èŠ‚ç‚¹å¹¶è¿›å…¥äº¤äº’å¼æŽ§åˆ¶å°ï¼Œ`--datadir`é€‰é¡¹æŒ‡å®šä½¿ç”¨`data0`ä½œä¸ºæ•°æ®ç›®å½•ï¼Œ`--networkid`é€‰é¡¹åŽé¢è·Ÿä¸€ä¸ªæ•°å­— 2018ï¼Œè¡¨ç¤ºæŒ‡å®šè¿™ä¸ªç§æœ‰é“¾çš„ç½‘ç»œidä¸º2018ã€‚ç½‘ç»œidåœ¨è¿žæŽ¥åˆ°å…¶ä»–èŠ‚ç‚¹çš„æ—¶å€™ä¼šç”¨åˆ°ï¼Œä»¥å¤ªåŠå…¬ç½‘çš„ç½‘ç»œ id æ˜¯1ï¼Œä¸ºäº†ä¸ä¸Žå…¬æœ‰é“¾ç½‘ç»œå†²çªï¼Œè¿è¡Œç§æœ‰é“¾èŠ‚ç‚¹çš„æ—¶å€™è¦æŒ‡å®šè‡ªå·±çš„ç½‘ç»œ idã€‚è¿è¡Œä¸Šé¢çš„å‘½ä»¤åŽï¼Œå°±å¯åŠ¨äº†åŒºå—é“¾èŠ‚ç‚¹å¹¶è¿›å…¥äº†Javascript Consoleï¼š

```javascript
INFO [11-04|16:51:13.102] Starting P2P networking 
INFO [11-04|16:51:15.224] UDP listener up                          self=enode://1d464c3eeff748edaf49ff582c4face5a42be81ec6be37d2044c408935dbb76d95a2bb66b38fcf874cb59a124238cd00c86ce0fad96499490ef24f573272cee5@[::]:30303
INFO [11-04|16:51:15.225] RLPx listener up                         self=enode://1d464c3eeff748edaf49ff582c4face5a42be81ec6be37d2044c408935dbb76d95a2bb66b38fcf874cb59a124238cd00c86ce0fad96499490ef24f573272cee5@[::]:30303
INFO [11-04|16:51:15.227] IPC endpoint opened                      url=/Users/nino/shuju/geth.ipc
INFO [11-04|16:51:15.227] HTTP endpoint opened                     url=http://172.19.93.219:8545  cors=* vhosts=localhost
Welcome to the Geth JavaScript console!

instance: Geth/v1.8.14-stable/darwin-amd64/go1.11
INFO [11-04|16:51:15.314] Etherbase automatically configured       address=0x78d2E183cb87bEb22fb8d09ef34675F8bbAc8e15
coinbase: 0x78d2e183cb87beb22fb8d09ef34675f8bbac8e15
at block: 95 (Sun, 04 Nov 2018 16:27:03 CST)
 datadir: /Users/nino/shuju
 modules: admin:1.0 debug:1.0 eth:1.0 ethash:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0
```

è¿™æ˜¯ä¸€ä¸ªäº¤äº’å¼çš„ Javascript æ‰§è¡ŒçŽ¯å¢ƒï¼Œåœ¨è¿™é‡Œé¢å¯ä»¥æ‰§è¡Œ Javascript ä»£ç ï¼Œå…¶ä¸­ > æ˜¯å‘½ä»¤æç¤ºç¬¦ã€‚åœ¨è¿™ä¸ªçŽ¯å¢ƒé‡Œä¹Ÿå†…ç½®äº†ä¸€äº›ç”¨æ¥æ“ä½œä»¥å¤ªåŠçš„ Javascript å¯¹è±¡ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚è¿™äº›å¯¹è±¡ä¸»è¦åŒ…æ‹¬ï¼š

| å¯¹è±¡     | ç”¨é€”                                     |
| -------- | ---------------------------------------- |
| eth      | åŒ…å«ä¸€äº›è·Ÿæ“ä½œåŒºå—é“¾ç›¸å…³çš„æ–¹æ³•           |
| net      | åŒ…å«ä»¥ä¸‹æŸ¥çœ‹ P2P ç½‘ç»œçŠ¶æ€çš„æ–¹æ³•          |
| admin    | åŒ…å«ä¸€äº›ä¸Žç®¡ç†èŠ‚ç‚¹ç›¸å…³çš„æ–¹æ³•             |
| miner    | åŒ…å«å¯åŠ¨ã€åœæ­¢æŒ–çŸ¿çš„ä¸€äº›æ–¹æ³•             |
| personal | ä¸»è¦åŒ…å«ä¸€äº›ç®¡ç†è´¦æˆ·çš„æ–¹æ³•               |
| txpool   | åŒ…å«ä¸€äº›æŸ¥çœ‹äº¤æ˜“å†…å­˜æ± çš„æ–¹æ³•             |
| web3     | åŒ…å«äº†ä»¥ä¸Šå¯¹è±¡ï¼Œè¿˜åŒ…å«ä¸€äº›å•ä½æ¢ç®—çš„æ–¹æ³• |



## ç§æœ‰é“¾èŠ‚ç‚¹æ“ä½œ

### åˆ›å»ºè´¦æˆ·

åˆšæ­å»ºå¥½çš„ç§æœ‰é“¾æ˜¯æ²¡æœ‰è´¦æˆ·çš„ï¼Œè¾“å…¥ï¼š

```json
> eth.accounts
```

å‘çŽ°è´¦æˆ·ä¸ºç©ºï¼ŒæŽ¥ä¸‹æ¥ä½¿ç”¨`personal`å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼š

```json 
> personal.newAccount("è´¦æˆ·å¯†ç ")
```

æˆ‘ä»¬é€šè¿‡è¿™ç§æ–¹æ³•å†åˆ›å»ºè´¦æˆ·ï¼š

``` json
> eth.accounts
["0x78d2e183cb87beb22fb8d09ef34675f8bbac8e15", "0x6f1f96c9131ad12f1ddcd9d195fdce6d0790b063"]
```

è´¦æˆ·é»˜è®¤ä¼šä¿å­˜åœ¨æ•°æ®ç›®å½•çš„ keystore æ–‡ä»¶å¤¹ä¸­ã€‚æŸ¥çœ‹ç›®å½•ç»“æž„ï¼Œå‘çŽ°`shuju/keystore`ä¸­å¤šäº†ä¸¤ä¸ªæ–‡ä»¶ï¼ˆ*åˆ†åˆ«å¯¹åº”äºŽä¸¤ä¸ªè´¦æˆ·*ï¼‰ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶å°±å¯¹åº”åˆšæ‰åˆ›å»ºçš„ä¸¤ä¸ªè´¦æˆ·ï¼Œè¿™æ˜¯ json æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥æ‰“å¼€æŸ¥çœ‹ï¼Œé‡Œé¢å­˜çš„æ˜¯ç§é’¥ç»è¿‡å¯†ç åŠ å¯†åŽçš„ä¿¡æ¯ã€‚æ¯”å¦‚ "...8e15" ï¼š

```json
{"address":"78d2e183cb87beb22fb8d09ef34675f8bbac8e15","crypto":{"cipher":"aes-128-ctr","ciphertext":"c1a6c65452655416e0dde61ac1e45c7a98c36d224d9a6ce2b688bb64d44c00f0","cipherparams":{"iv":"57cc60fb258e5e2bfc0adef32ed18324"},"kdf":"scrypt","kdfparams":{"dklen":32,"n":262144,"p":1,"r":8,"salt":"fb65ff0c0dc5bf41f27897b12ce617c5cc971ea3ab809bb0105a33c374d7f3bc"},"mac":"aee378c2c16e566eb569f8da2ea2d2edc75f6d772e9dd276d6e1507e402494da"},"id":"515b2084-8f92-4053-9e5b-15ce917a66a3","version":3}
```

æ­¤æ—¶çš„ç›®å½•ç»“æž„å¦‚ä¸‹ï¼š

```
shuju
â”œâ”€â”€ geth
â”‚   â”œâ”€â”€ chaindata
â”‚   â”œâ”€â”€ LOCK
â”‚   â”œâ”€â”€ nodekey
â”‚   â””â”€â”€ nodes
â”œâ”€â”€ geth.ipc
â”œâ”€â”€ history
â””â”€â”€ keystore
    â”œâ”€â”€ UTC--2018-11-04T08-23-15.866675000Z--78d2e183cb87beb22fb8d09ef34675f8bbac8e15
    â””â”€â”€ UTC--2018-11-04T09-03-50.634292000Z--6f1f96c9131ad12f1ddcd9d195fdce6d0790b063
```

### æŸ¥çœ‹ä½™é¢

æŸ¥çœ‹è´¦æˆ·ä½™é¢ï¼š

```json
> eth.getBalance(eth.accounts[0])
0
> eth.getBalance(eth.accounts[1])
0
```

ç›®å‰ä¸¤ä¸ªè´¦æˆ·çš„ä»¥å¤ªå¸ä½™é¢éƒ½æ˜¯0ï¼Œè¦ä½¿è´¦æˆ·æœ‰ä½™é¢ï¼Œå¯ä»¥ä»Žå…¶ä»–è´¦æˆ·è½¬è´¦è¿‡æ¥ï¼Œæˆ–è€…é€šè¿‡æŒ–çŸ¿æ¥èŽ·å¾—ä»¥å¤ªå¸å¥–åŠ±ã€‚

### èŠ‚ç‚¹æŒ–çŸ¿

å¯åŠ¨æŒ–çŸ¿ï¼š

```json
> miner.start(1)
```

å…¶ä¸­`start`çš„å‚æ•°è¡¨ç¤ºæŒ–çŸ¿ä½¿ç”¨çš„çº¿ç¨‹æ•°ã€‚ç¬¬ä¸€æ¬¡å¯åŠ¨æŒ–çŸ¿ä¼šå…ˆç”ŸæˆæŒ–çŸ¿æ‰€éœ€çš„ DAG æ–‡ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æœ‰ç‚¹æ…¢ï¼Œç­‰è¿›åº¦è¾¾åˆ°100%åŽï¼Œå°±ä¼šå¼€å§‹æŒ–çŸ¿ï¼Œæ­¤æ—¶å±å¹•ä¼šè¢«æŒ–çŸ¿ä¿¡æ¯åˆ·å±ã€‚

å¦‚æžœæƒ³åœæ­¢æŒ–çŸ¿ï¼Œåœ¨ js consoleä¸­è¾“å…¥ï¼š

```json
> miner.stop()
```

**è¾“å…¥çš„å­—ç¬¦ä¼šè¢«æŒ–çŸ¿åˆ·å±ä¿¡æ¯å†²æŽ‰ï¼Œæ²¡æœ‰å…³ç³»ï¼Œåªè¦è¾“å…¥å®Œæ•´çš„`miner.stop()`ä¹‹åŽå›žè½¦ï¼Œå³å¯åœæ­¢æŒ–çŸ¿ã€‚**

æŒ–åˆ°ä¸€ä¸ªåŒºå—ä¼šå¥–åŠ±5ä¸ªä»¥å¤ªå¸ï¼ŒæŒ–çŸ¿æ‰€å¾—çš„å¥–åŠ±ä¼šè¿›å…¥çŸ¿å·¥çš„è´¦æˆ·ï¼Œè¿™ä¸ªè´¦æˆ·å«åšcoinbaseï¼Œé»˜è®¤æƒ…å†µä¸‹ coinbase æ˜¯æœ¬åœ°è´¦æˆ·ä¸­çš„ç¬¬ä¸€ä¸ªè´¦æˆ·ï¼š

```json
> eth.coinbase
"0x78d2e183cb87beb22fb8d09ef34675f8bbac8e15"
```

æŒ–åˆ°åŒºå—ä»¥åŽï¼Œè´¦æˆ· 0 é‡Œé¢åº”è¯¥å°±æœ‰ä½™é¢äº†ï¼š

```json
> eth.getBalance(eth.accounts[0])
475000000000000000000
```

`getBalance()`è¿”å›žå€¼çš„å•ä½æ˜¯`wei`ï¼Œ`wei`æ˜¯ä»¥å¤ªå¸çš„æœ€å°å•ä½ï¼Œ1ä¸ªä»¥å¤ªå¸=10çš„18æ¬¡æ–¹ä¸ª`wei`ã€‚è¦æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªä»¥å¤ªå¸ï¼Œå¯ä»¥ç”¨`web3.fromWei()`å°†è¿”å›žå€¼æ¢ç®—æˆä»¥å¤ªå¸ï¼š

```json
> web3.fromWei(eth.getBalance(eth.accounts[0]),'ether')
475
```

### å‘èµ·äº¤æ˜“

**è´¦æˆ·æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šè¢«é”ä½ï¼Œè¦å‘é€äº¤æ˜“ï¼Œå¿…é¡»å…ˆè§£é”è´¦æˆ·ã€‚**ç”±äºŽæˆ‘ä»¬è¦ä»Žè´¦æˆ· 0 å‘é€äº¤æ˜“ï¼Œæ‰€ä»¥è¦è§£é”è´¦æˆ· 0ï¼š

```json
> personal.unlockAccount(eth.accounts[0])
Unlock account 0x78d2e183cb87beb22fb8d09ef34675f8bbac8e15
Passphrase: 
true
```

å¯ä»¥é€šè¿‡å‘é€ä¸€ç¬”äº¤æ˜“ï¼Œä»Žè´¦æˆ· 0 è½¬ç§» 5 ä¸ªä»¥å¤ªå¸åˆ°è´¦æˆ· 1ï¼ˆâš ï¸ **æœ€åŽæ˜¾ç¤ºçš„äº¤æ˜“ ID ååˆ†é‡è¦ï¼Œæˆ‘ä»¬å°†ä¼šç”¨è¿™ä¸ª ID æ¥æŸ¥æ‰¾äº¤æ˜“**ï¼‰ï¼š

```json
> amount = web3.toWei(5,'ether')
"5000000000000000000"
> eth.sendTransaction({from:eth.accounts[0],to:eth.accounts[1],value:amount})
INFO [11-04|17:28:06.737] Setting new local account                address=0x78d2E183cb87bEb22fb8d09ef34675F8bbAc8e15
INFO [11-04|17:28:06.738] Submitted transaction                    fullhash=0x67ef39ca8d8c8bd3dec2e96342a3ccffaaa3385140a0d8ded4c24b20b3be854d recipient=0x6F1f96c9131aD12f1dDcd9D195Fdce6d0790b063
"0x67ef39ca8d8c8bd3dec2e96342a3ccffaaa3385140a0d8ded4c24b20b3be854d"
```

æ­¤æ—¶äº¤æ˜“å·²ç»æäº¤åˆ°åŒºå—é“¾ï¼Œè¿”å›žäº†äº¤æ˜“çš„ hashï¼Œä½†è¿˜æœªè¢«å¤„ç†ï¼Œè¿™å¯ä»¥é€šè¿‡æŸ¥çœ‹ `txpool` æ¥éªŒè¯ï¼š

```json
> txpool.status
{
  pending: 1,
  queued: 0
}
```

å…¶ä¸­æœ‰ä¸€æ¡ pending çš„äº¤æ˜“ï¼Œpending è¡¨ç¤ºå·²æäº¤ä½†è¿˜æœªè¢«å¤„ç†çš„äº¤æ˜“ã€‚

### ç¡®è®¤äº¤æ˜“

è¦ä½¿äº¤æ˜“è¢«å¤„ç†ï¼Œå¿…é¡»è¦æŒ–çŸ¿ã€‚è¿™é‡Œæˆ‘ä»¬å¯åŠ¨æŒ–çŸ¿ï¼Œç„¶åŽç­‰å¾…æŒ–åˆ°ä¸€ä¸ªåŒºå—ä¹‹åŽå°±åœæ­¢æŒ–çŸ¿ï¼š

```json
> miner.start(1); admin.sleepBlocks(1); miner.stop();
```

å¦‚ä¸‹æ˜¾ç¤ºè¡¨ç¤ºæŒ–çŸ¿æˆåŠŸï¼š

```json
INFO [11-04|17:31:12.566] Updated mining threads                   threads=1
INFO [11-04|17:31:12.566] Transaction pool price threshold updated price=18000000000
INFO [11-04|17:31:12.572] Commit new mining work                   number=96 uncles=0 txs=0 gas=0 fees=0 elapsed=6.319ms
INFO [11-04|17:31:12.573] Commit new mining work                   number=96 uncles=0 txs=1 gas=21000 fees=0.000378 elapsed=6.867ms
INFO [11-04|17:31:16.781] Successfully sealed new block            number=96 hash=ddc2bbâ€¦215191 elapsed=4.208s
INFO [11-04|17:31:16.782] ðŸ”¨ mined potential block                  number=96 hash=ddc2bbâ€¦215191
INFO [11-04|17:31:16.782] Commit new mining work                   number=97 uncles=0 txs=0 gas=0     fees=0        elapsed=171.356Âµs
true
```

`txpool`ä¸­pendingçš„äº¤æ˜“æ•°é‡åº”è¯¥ä¸º0äº†ï¼Œè¯´æ˜Žäº¤æ˜“å·²ç»è¢«å¤„ç†äº†ï¼š

```json
> txpool.status
{
  pending: 0,
  queued: 0
}
```

æ­¤æ—¶ï¼Œäº¤æ˜“å·²ç»ç”Ÿæ•ˆï¼Œè´¦æˆ·ä¸€åº”è¯¥å·²ç»æ”¶åˆ°äº†5ä¸ªä»¥å¤ªå¸äº†ï¼š

```json
> web3.fromWei(eth.getBalance(eth.accounts[1]),'ether')
5
```

### åŒºå—æ•°é‡

æŸ¥çœ‹å½“å‰åŒºå—æ€»æ•°ï¼š

```json
> eth.blockNumber
96
```

æ‰€ä»¥è¯´ç›®å‰æˆ‘ä»¬çš„ç§æœ‰é“¾ä¸Šæœ‰ 96 ä¸ªåŒºå—ã€‚

### æŸ¥çœ‹äº¤æ˜“

é€šè¿‡äº¤æ˜“hashæŸ¥çœ‹äº¤æ˜“ï¼š

``` json
> eth.getTransaction("0x67ef39ca8d8c8bd3dec2e96342a3ccffaaa3385140a0d8ded4c24b20b3be854d")
{
  blockHash: "0xddc2bbbeaa686cc5c9c6b2d3d8a9f942a53a9051bc06e9d649e4de1e3a215191",
  blockNumber: 96,
  from: "0x78d2e183cb87beb22fb8d09ef34675f8bbac8e15",
  gas: 90000,
  gasPrice: 18000000000,
  hash: "0x67ef39ca8d8c8bd3dec2e96342a3ccffaaa3385140a0d8ded4c24b20b3be854d",
  input: "0x",
  nonce: 0,
  r: "0xb852d78a0483ba05a21e3701c74bd86ed2dd52867b59258170e7feb8ba3f0414",
  s: "0x3c752d3d485e1f7ed16bec78629be07bf377c4de9b041b11388263d943a66fd3",
  to: "0x6f1f96c9131ad12f1ddcd9d195fdce6d0790b063",
  transactionIndex: 0,
  v: "0x557",
  value: 5000000000000000000
}
```

**äº¤æ˜“ä¸­å„ä¸ªå­—æ®µçš„å«ä¹‰**ï¼š

- `hash`æ˜¯äº¤æ˜“çš„å“ˆå¸Œå€¼ï¼Œ`nonce`ç”¨æ¥åŒºåˆ«åŒä¸€ç”¨æˆ·å‘å‡ºçš„ä¸åŒäº¤æ˜“çš„æ ‡è®°;
- `blockHash`æ˜¯å°è£…äº‹åŠ¡ï¼ˆäº¤æ˜“ï¼‰çš„åŒºå—å“ˆå¸Œå€¼ï¼Œ`blockNumber`æ˜¯è¯¥åŒºå—åœ¨æˆ‘ä»¬æž„å»ºçš„ç§æœ‰é“¾çš„åºå·ï¼›
- `from` å’Œ `to` å­—æ®µè§„å®šäº†äº¤æ˜“çš„åŒæ–¹ï¼Œ`value`å­—æ®µè§„å®šäº†äº¤æ˜“çš„æ•°é¢ï¼›
- `gas` è¡¨ç¤ºè¿™ä¸ªäº¤æ˜“å…è®¸æ¶ˆè€—çš„æœ€å¤§ Gas æ•°é‡ï¼Œ`gasPrice`è¡¨ç¤ºå‘é€è€…æ„¿æ„æ”¯ä»˜ç»™çŸ¿å·¥çš„ Gas ä»·æ ¼ï¼›
- `r`ã€`s`ã€`V` ä¸ºäº¤æ˜“ç­¾åçš„ä¸‰ä¸ªéƒ¨åˆ†ï¼Œç”±å‘é€è€…çš„ç§é’¥å¯¹äº¤æ˜“å“ˆå¸Œè¿›è¡Œç­¾åç”Ÿæˆã€‚

### æŸ¥çœ‹åŒºå—

é€šè¿‡åŒºå—å·æŸ¥çœ‹åŒºå—ï¼š

```json
> eth.getBlock(96) 
> eth.getBlock("0xddc2bbbeaa686cc5c9c6b2d3d8a9f942a53a9051bc06e9d649e4de1e3a215191")
{
  difficulty: 131072,
  extraData: "0xd78301080e846765746886676f312e31318664617277696e",
  gasLimit: 15275265,
  gasUsed: 21000,
  hash: "0xddc2bbbeaa686cc5c9c6b2d3d8a9f942a53a9051bc06e9d649e4de1e3a215191",
  logsBloom: "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
  miner: "0x78d2e183cb87beb22fb8d09ef34675f8bbac8e15",
  mixHash: "0x4b72e2f521d9a45d53920d0af22c575eeb2ad489bab41d0b509584b86bd096ff",
  nonce: "0x0dc5a55c24b91e34",
  number: 96,
  parentHash: "0xff22f6f888c08e290b292ad105b9c72b4ff206c57e78a8393d38a94b4ea6ddd3",
  receiptsRoot: "0xa45d92ea3058f83814c424a8d4bdf5c3cd65742545569c3f3ede75b2ca2e6be1",
  sha3Uncles: "0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
  size: 651,
  stateRoot: "0x346e3b94dfaebfb891f5d9d41204b83ed173230fa9d6e62016e9f3453f7cbcaf",
  timestamp: 1541323872,
  totalDifficulty: 12844361,
  transactions: ["0x67ef39ca8d8c8bd3dec2e96342a3ccffaaa3385140a0d8ded4c24b20b3be854d"],
  transactionsRoot: "0x9fae89d7136c768294f0eb495f140308ee858f2e54de9b537f89970a4e917fee",
  uncles: []
}
```

**åŒºå—ä¸­å„ä¸ªå­—æ®µçš„å«ä¹‰**ï¼š

- `difficulty` æ˜¯æŒ–å‡ºè¯¥åŒºå—çš„éš¾åº¦ï¼Œ`totalDifficulty`æ˜¯ç›®å‰æŒ–çŸ¿çš„éš¾åº¦ç§¯ç´¯ï¼Œ `nonce` æ˜¯ç”¨æ¥ PoW çš„æ— æ„ä¹‰6ä½å“ˆå¸Œæ•°ï¼›
- `hash` æ˜¯åŒºå—çš„å“ˆå¸Œå€¼ï¼Œ`mixHash` 256ä½ Hash å€¼ï¼Œå½“ä¸Ž `nonce` ç»„åˆæ—¶ï¼Œè¯æ˜Žæ­¤åŒºå—å·²ç»æ‰§è¡Œäº†è¶³å¤Ÿçš„è®¡ç®—ï¼›
- `size`ä¸ºåŒºå—çš„å¤§å°ï¼Œ`miner` æŒ–æŽ˜å‡ºè¿™ä¸ªåŒºå—çš„ä½œè€…åœ°å€ï¼›
- `number` åŒºå—çš„åºå·ï¼Œç­‰äºŽå…¶çˆ¶åŒºå—çš„ `number` +1ï¼Œ`timestamp` åŒºå—åº”è¢«åˆ›å»ºçš„æ—¶é—´æˆ³ï¼Œç”±å…±è¯†ç®—æ³•ç¡®å®šï¼›
- `gasLimit` åŒºå—çš„ `gas` æ¶ˆè€—çš„ç†è®ºä¸Šé™ï¼Œ`gasUsed` æ˜¯å®žé™…æ¶ˆè€—çš„ `gas` æ€»å’Œï¼›

- `parentHash`çˆ¶åŒºå—çš„æŒ‡é’ˆï¼Œ`uncles` [å”åŒºå—](https://blog.csdn.net/weixin_42874184/article/details/81735695) æ˜¯ç”¨æ¥å¯¹å­¤ç«‹åŒºå—è¿›è¡Œå¥–åŠ±çš„ä¸€ä¸ª Header æ•°ç»„ï¼Œ`sha3Uncles` æ˜¯ [å”åŒºå—](https://blog.csdn.net/weixin_42874184/article/details/81735695) ä»¬çš„å®‰å…¨æ•£åˆ—ï¼›
- `receiptsRoot` Block ä¸­çš„ "Receipt Trieâ€çš„æ ¹èŠ‚ç‚¹çš„ RLP å“ˆå¸Œå€¼ï¼ŒBlock çš„æ‰€æœ‰ Transaction æ‰§è¡Œå®ŒåŽä¼šç”Ÿæˆä¸€ä¸ª Receipt æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰ Receipt è¢«é€ä¸ªæ’å…¥ä¸€ä¸ª MPT ç»“æž„ä¸­ï¼Œå½¢æˆ"Receipt Trie"ï¼›
- `stateRoot` StateDB ä¸­çš„â€œstate Trieâ€çš„æ ¹èŠ‚ç‚¹çš„ RLP å“ˆå¸Œå€¼ï¼Œæ¯ä¸ªè´¦æˆ·ä»¥ stateObject å¯¹è±¡è¡¨ç¤ºï¼Œè´¦æˆ·ä»¥ Address ä¸ºå”¯ä¸€æ ‡ç¤ºï¼Œå…¶ä¿¡æ¯åœ¨ç›¸å…³äº¤æ˜“çš„æ‰§è¡Œä¸­è¢«ä¿®æ”¹ï¼Œæ‰€æœ‰è´¦æˆ·å¯¹è±¡å¯ä»¥é€ä¸ªæ’å…¥ä¸€ä¸ªMerkle Patrica Trieï¼ˆMPTï¼‰ç»“æž„é‡Œï¼Œå½¢æˆâ€œstate Trieâ€ï¼›
- `transactionRoot` Block ä¸­ â€œtx Trieâ€çš„æ ¹èŠ‚ç‚¹çš„ RLP å“ˆå¸Œå€¼ï¼ŒBlock çš„æˆå‘˜å˜é‡ transactions ä¸­æ‰€æœ‰çš„ tx å¯¹è±¡ï¼Œè¢«é€ä¸ªæ’å…¥ä¸€ä¸ª MPT ç»“æž„ï¼Œå½¢æˆâ€œtx Trieâ€ï¼›
- `logsBloom` Bloom è¿‡æ»¤å™¨ï¼Œç”¨æ¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå‚æ•° Log å¯¹è±¡æ˜¯å¦å­˜åœ¨äºŽä¸€ç»„å·²çŸ¥çš„ Log é›†åˆä¸­ï¼›
- `extraData` åŒºå—åˆ›å»ºè€…å¯ä»¥è®°å½•ä¸€äº›ä¸Žè¯¥åŒºå—æœ‰å…³çš„ä¿¡æ¯ï¼Œé•¿åº¦å°äºŽç­‰äºŽ32å­—èŠ‚å³å¯ã€‚



## æ™ºèƒ½åˆçº¦

### åˆçº¦å®šä¹‰

ç”¨ Solidity å®šä¹‰ä¸€ä¸ªæ™ºèƒ½åˆçº¦ `Nino.propose()`ï¼š

```javascript
pragma solidity ^0.4.18;

contract Nino {
    string word;
    
    function Nino(string _word) public {
        word = _word;
    }

    function propose() constant public returns (string) {
        return word;
    }
}
```

åœ¨ [Remix](http://remix.ethereum.org/#optimize=false&version=soljson-v0.4.25+commit.59dbf8f1.js) æ–‡æœ¬æ¡†å¤åˆ¶è¿™æ®µä»£ç ï¼Œè¿›è¡Œè°ƒè¯•ï¼Œç¼–è¯‘æ— è¯¯åŽç‚¹å‡» Detailï¼Œ

![](https://ws2.sinaimg.cn/large/006tNbRwgy1fww9z16epoj31kw0toao5.jpg)

å¯ä»¥ä»Žå¼¹å‡ºçª—å£æ‰¾åˆ° `WEB3DEPLOY`ï¼ŒæŠŠçº¢çº¿éƒ¨åˆ†çš„è¯æ¢æˆ Nino çš„ proposeï¼š

![](https://ws3.sinaimg.cn/large/006tNbRwgy1fwwa21pmeaj31801audwd.jpg)

### éƒ¨ç½²åˆçº¦

å¤åˆ¶ä»¥ä¸Šå†…å®¹ï¼Œ**å› ä¸ºéƒ¨ç½²åˆçº¦æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§äº¤æ˜“ï¼Œåœ¨éƒ¨ç½²å‰éœ€è¦æŠŠéƒ¨ç½²è€… account[1] è§£é”ï¼ˆUnlockï¼‰**ï¼š

```json
> personal.unlockAccount(eth.accounts[1])
Unlock account 0x6f1f96c9131ad12f1ddcd9d195fdce6d0790b063
Passphrase: 
true
```

å¹¶æŠŠå…¶è¾“å…¥ JS Consoleï¼š

``` json
var _word = "I'm 16340154, please give me a high score";
var ninoContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"propose","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_word","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);
var nino = ninoContract.new(
   _word,
   {
     from: web3.eth.accounts[1], 
     data: '0x608060405234801561001057600080fd5b506040516102a83803806102a8833981018060405281019080805182019291905050508060009080519060200190610049929190610050565b50506100f5565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061009157805160ff19168380011785556100bf565b828001600101855582156100bf579182015b828111156100be5782518255916020019190600101906100a3565b5b5090506100cc91906100d0565b5090565b6100f291905b808211156100ee5760008160009055506001016100d6565b5090565b90565b6101a4806101046000396000f300608060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c198f8ba14610046575b600080fd5b34801561005257600080fd5b5061005b6100d6565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561009b578082015181840152602081019050610080565b50505050905090810190601f1680156100c85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b606060008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561016e5780601f106101435761010080835404028352916020019161016e565b820191906000526020600020905b81548152906001019060200180831161015157829003601f168201915b50505050509050905600a165627a7a7230582001962db1111855ac0f746def769de3d5475e132807426af7c33f7abe7c417a060029', 
     gas: '4700000'
   }, function (e, contract){
    console.log(e, contract);
    if (typeof contract.address !== 'undefined') {
         console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
    }
 })
```

**å³ä½¿å¤åˆ¶ä¸ŠåŽ»äº†ä¹‹åŽï¼Œæˆ‘ä»¬è¿˜ä¸èƒ½ç€æ€¥è¿è¡Œï¼Œæˆ‘ä»¬è¿˜è¦è¿›è¡ŒæŒ–çŸ¿æŠŠ pending çš„äº¤æ˜“å°è£…æˆå—`miner.start()`è®©äº¤æ˜“å¾—åˆ°ç¡®è®¤æ‰èƒ½è¿è¡Œåˆçº¦**ï¼š

```json
> miner.start(1); admin.sleepBlocks(1); miner.stop();
INFO [11-04|20:06:17.040] Updated mining threads                   threads=1
INFO [11-04|20:06:17.040] Transaction pool price threshold updated price=18000000000
INFO [11-04|20:06:17.040] Commit new mining work                   number=162 uncles=0 txs=0 gas=0       fees=0          elapsed=124.139Âµs
INFO [11-04|20:06:17.041] Commit new mining work                   number=162 uncles=0 txs=1 gas=242793  fees=0.004370274 elapsed=517.207Âµs
INFO [11-04|20:06:18.184] Successfully sealed new block            number=162 hash=3bae74â€¦9bb332 elapsed=1.143s
INFO [11-04|20:06:18.192] ðŸ”— block reached canonical chain          number=157 hash=787e98â€¦9ebcc5
INFO [11-04|20:06:18.192] ðŸ”¨ mined potential block                  number=162 hash=3bae74â€¦9bb332
INFO [11-04|20:06:18.192] Commit new mining work                   number=163 uncles=0 txs=0 gas=0       fees=0           elapsed=161.24Âµs
true
> null [object Object]
```

ç»ˆäºŽæˆåŠŸäº† âœŒï¸ï¼š

```json
Contract mined! address: 0x0ea4925971b634f91310d8d1d61fad8734b9a09f transactionHash: 0xb2ac1920b1fddd2d6b032ac9204ac963a8eaf0e793a0b8803ce5433e8c85ae68
```

é‚£ä¹ˆ Nino çš„ proposal åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼ŸðŸ¤”ï¸

```json
> nino.propose()
"I'm 16340154, please give me a high score"
```

*å¸Œæœ›å®ƒèƒ½å¤Ÿå®žçŽ°ï¼Œå› ä¸ºå®ƒä¸ºäº†éƒ¨ç½²è¿™ä¸ªåˆçº¦å¯æ˜¯èŠ±äº†é’±å‘¢ *ðŸ’°ï¼š

```json
> eth.getBalance(eth.accounts[1])
4979037452000000000 					// < 5000000000000000000
```



## å‚è€ƒ&é¸£è°¢

â€œå–æ°´ä¸å¿˜æŒ–äº•äººâ€ï¼Œè¿™é‡Œç‰¹åˆ«æ„Ÿè°¢ä¸€ä¸‹å‡ ä¸ªåšä¸»çš„ä¼˜ç§€åšæ–‡ï¼š

- [åŒºå—é“¾æ™ºèƒ½åˆçº¦å¼€å‘](http://inpluslab.com/20181015/)
- [ä»¥å¤ªåŠï¼ˆä¸€ï¼‰MACä¸Šä»¥å¤ªåŠç§æœ‰é“¾æ­å»º](https://www.jianshu.com/p/235c24aee284)
- [ä»¥å¤ªåŠçš„åŒºå—å’Œå­˜å‚¨ï¼ˆäºŒï¼‰ï¼šåŒºå—ä½“ä¹‹å”åŒºå—](https://blog.csdn.net/weixin_42874184/article/details/81735695)
- [ä»¥å¤ªåŠæ•°æ®ç»“æž„ã€å­˜å‚¨ã€åŒºå—å¤´çš„å…³ç³»ä¸Žåˆ†æž](https://blog.csdn.net/Metal1/article/details/80203691)
- [æ™ºèƒ½åˆçº¦å¼€å‘çŽ¯å¢ƒæ­å»ºåŠ Hello World åˆçº¦](https://learnblockchain.cn/2017/11/24/init-env/)
